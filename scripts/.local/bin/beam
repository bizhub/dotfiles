#!/bin/bash

PORT=8000
IP=$(ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v '^127\.' | head -n 1)
URL="http://$IP:$PORT"

# Colors
RED='\033[1;31m'
GREEN='\033[1;32m'
CYAN='\033[1;36m'
YELLOW='\033[1;33m'
MAGENTA='\033[1;35m'
NC='\033[0m'

trap 'echo -e "\n${RED}Server stopped.${NC}"; exit 0' INT

echo -e "${CYAN}"
printf "██████  ███████  █████  ███    ███      ⣀\n"
printf "██   ██ ██      ██   ██ ████  ████      ⠤⠉⢻⡰⠲⣤⢴⣠⣀⣄⣠⣤⡄⢤⠠⡄⡤⣄⡄\n"
printf "██████  █████   ███████ ██╔████╔██      ⡏⠀⠜⣧⡓⡎⣥⢡⡍⢬⡡⢥⠬⣡⢍⡬⢡⢼⡸\n"
printf "██╔══██ ██╔══╝  ██╔══██ ██  ██  ██      ⡇⠀⢆⣿⣷⣷⣿⣾⣷⣾⣷⣾⣶⣿⣾⣷⣾⣾⣷\n"
printf "██████  ███████ ██║  ██ ██      ██      ⢥⡐⣸⣿⠿⠿⠻⠿⠽⠟⠿⠻⠟⠯⠿⠻⠿⠿⠇\n"
echo -e "${NC}\n"

echo -e "${GREEN}Serving folder:${NC} $(pwd)"
echo -e "${GREEN}Your download link:${NC} ${YELLOW}${URL}${NC}\n"

total_files=$(find . -maxdepth 1 -type f | wc -l)
total_dirs=$(find . -maxdepth 1 -type d | wc -l)
total_size=$(du -sh . | cut -f1)

printf "%-20s %s\n" "Total files" "$total_files"
printf "%-20s %s\n" "Subfolders" "$((total_dirs-1))"
printf "%-20s %s\n" "Total size" "$total_size"

ls -lhS | grep -v '^d' | head -n 5 | awk '{printf "%-10s %s\n", $5, $9}'
echo

if command -v wl-copy >/dev/null 2>&1; then
    echo -e "${CYAN}URL copied to clipboard using wl-copy${NC}"
    echo -n "$URL" | wl-copy
elif command -v xclip >/dev/null 2>&1; then
    echo -e "${CYAN}URL copied to clipboard using xclip${NC}"
    echo -n "$URL" | xclip -selection clipboard
elif command -v xsel >/dev/null 2>&1; then
    echo -e "${CYAN}URL copied to clipboard using xsel${NC}"
    echo -n "$URL" | xsel --clipboard --input
else
    echo -e "${RED}No clipboard tool found. Install xclip, xsel, or wl-copy to auto-copy the URL.${NC}\n"
fi

echo -e "${CYAN}Press Ctrl+C to stop the server${NC}\n"

python3 -u -m http.server "$PORT" >/dev/null 2>&1
